{% extends "page_base.html" %}

{% load entrak_extras %}
{% load static %}
{% load humanize %}

{% block extra_head %}
{{block.super}}

<link rel="stylesheet" type="text/css" href="{% static 'css/drop-down-panel.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/report.css' %}">
<script src="{% static 'js/jquery-cookie-master/jquery.cookie.js' %}"></script>
<script src="{% static 'js/csrf_ajax.js' %}"></script>
<script src="{% static 'js/moment-timezone-with-data.min.js' %}"></script>
<script src="{% static 'js/mustache.js-master/mustache.js' %}"></script>
<script src="{% static 'js/jquery.tinysort.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.pie.min.js' %}"></script>
<script src="{% static 'js/entrak-system.js' %}"></script>
<script src="{% static 'js/entrak-utils.js' %}"></script>
<script src="{% static 'js/report-generator.js' %}"></script>
{% endblock %}

{% block selected-menu-link-id %}menu-link-report{% endblock %}
{% block system_menu_target_view %}report{% endblock %}
{% block breadcrumb_target_view %}report{% endblock %}

{% block page_title %}THE REPORTS PAGE{% endblock %}
{% block page_subtitle %}Get all your information here at the{% endblock %}

{% block extra_script %}
{{block.super}}

<script id="key-statistics-row-template" type="x-tmpl-mustache">
<div class="key-statistics-row">
	<span class="usage-type-name" style="background-color: {% templatetag openvariable %}nameBackgroundColor{% templatetag closevariable %};" order="{% templatetag openvariable %}order{% templatetag closevariable %}">{% templatetag openvariable %}usageTypeName{% templatetag closevariable %}</span>
	<span>{% templatetag openvariable %}energyVal{% templatetag closevariable %}</span>
	<span>{% templatetag openvariable %}co2Val{% templatetag closevariable %}</span>
	<span>{% templatetag openvariable %}moneyVal{% templatetag closevariable %}</span>
</div>
</script>

<script id="key-percent-sub-info-template" type="x-tmpl-mustache">
<div class="key-percent-sub-info" style="color: {% templatetag openvariable %}color{% templatetag closevariable %};">
	<span>{% templatetag openvariable %}bullet{% templatetag closevariable %}</span><span class="sub-info-name">{% templatetag openvariable %}name{% templatetag closevariable %}</span><br>
	<span class="sub-info-percent">{% templatetag openvariable %}percentVal{% templatetag closevariable %}</span>
</div>
</script>

<script id="sub-calendar-info-template" type="x-tmpl-mustache">
<div class="sub-calendar-info-block {% templatetag openvariable %}classIdentifier{% templatetag closevariable %}">
	<div class="sub-calendar-title">{% templatetag openvariable %}name{% templatetag closevariable %}</div>
	<div class="calendar-left-info">
		<div class="calendar-average-cell">
			<div>Average<br>{% templatetag openvariable %}typeName{% templatetag closevariable %}<br>Energy Use:</div>
			<div>
				<div class="average-usage">{% templatetag openvariable %}averageUsage{% templatetag closevariable %}</div>
				<div class="average-usage-unit">kWh</div>
			</div>
		</div>
		<div class="calendar-left-compare-info compare-beginning {% templatetag openvariable %}compareBeginningClass{% templatetag closevariable %}">
			<span class="compare-percent">{% templatetag openvariable %}compareBeginningPercent{% templatetag closevariable %}</span><span>%</span>
			<div class="compare-subtext">{% templatetag openvariable %} & compareBeginningSubtext{% templatetag closevariable %}</div>
		</div>
		<div class="calendar-left-compare-info compare-last {% templatetag openvariable %}compareLastClass{% templatetag closevariable %}">
			<span class="compare-percent">{% templatetag openvariable %}compareLastPercent{% templatetag closevariable %}</span><span>%</span>
			<div class="compare-subtext">{% templatetag openvariable %} & compareLastSubtext{% templatetag closevariable %}</div>
		</div>
		<div class="calendar-left-compare-info compare-last-same-period {% templatetag openvariable %}compareLastSamePeriodClass{% templatetag closevariable %}">
			<span class="compare-percent">{% templatetag openvariable %}compareLastSamePeriodPercent{% templatetag closevariable %}</span><span>%</span>
			<div class="compare-subtext">{% templatetag openvariable %} & compareLastSamePeriodSubtext{% templatetag closevariable %}</div>
		</div>
	</div>
	<div class="calendar-right-info">
		<div class="energy-split-text">Energy Split by:</div>
		<div class="energy-split-pie"></div>
		<div class="energy-split-legend">
			<div>
				<span>{% templatetag openvariable %}firstSplitText{% templatetag closevariable %}: </span><span class="first-split-val">{% templatetag openvariable %}firstSplitPercent{% templatetag closevariable %}</span>
			</div>
			<div>
				<span>{% templatetag openvariable %}secondSplitText{% templatetag closevariable %}: </span><span class="second-split-val">{% templatetag openvariable %}secondSplitPercent{% templatetag closevariable %}</span>
			</div>
		</div>
		<hr>
		<div class="sub-calendar-info-low-hight-title">Lowest {% templatetag openvariable %}typeName{% templatetag closevariable %} Energy Use</div>
		<div class="sub-calendar-info-lowest">{% templatetag openvariable %}lowestText{% templatetag closevariable %}</div>
		<div class="sub-calendar-info-low-hight-title">Highest {% templatetag openvariable %}typeName{% templatetag closevariable %} Energy Use</div>
		<div class="sub-calendar-info-lowest">{% templatetag openvariable %}highestText{% templatetag closevariable %}</div>
	</div>
</div>
</script>

<script type="text/javascript">

var report = {};

function genReportName(targetDt) {
	var reportName = "";
	if (report.currentReportType === ReportGenerator.REPORT_TYPE_MONTH) {
		reportName = targetDt.format("MMM YYYY");
	}

	return reportName;
}

function updateReportName() {
	var reportName = genReportName(report.currentDt);
	$(".report-name").text(reportName + " - Monthly Energy Report");
}

$(function() {
	setupAjaxForCsrf($.cookie('csrftoken'));

	report.entrakSystem = new EntrakSystem();
	report.entrakSystem.assignSystemTree('{{systems|jsonifySystems}}');

	report.currentReportType = ReportGenerator.REPORT_TYPE_MONTH;
	report.timezone = '{{systems.0.timezone}}';
	{% if monthly_summary|length >= 1 %}
	report.currentDt =  moment.unix({{monthly_summary.0.timestamp}}).tz(report.timezone);
	{% endif %}

	updateReportName();

	report.reportGenerator = new ReportGenerator(report.entrakSystem.systemTree, report.timezone);
	if ("currentDt" in report) {
		report.reportGenerator.getReportData(report.currentDt, function(data) {
			report.reportGenerator.assignData(data);
			report.reportGenerator.generateFullReport();
		});
	}

	$(".hide-details-btn").click(function() {
		$(this).toggleClass('btn-down');
	})
});
</script>
{% endblock %}

{% block page_content %}

<div class="panel-component">
	<div class="drop-down-panel-header">
		<div class="panel-header-left-menu">
			<h3>Monthly Report</h3><h3>Customize Report</h3><h3>Download Data</h3>
		</div>
	</div>

	<div id="panel-content">
		<div id="monthly-report">
			<div id="monthly-report-header">
				<span>Monthly Reports</span>
				<span>Energy Consumption (kWh)</span>
				<span>CO<sub>2</sub> Emissions (kg)</span>
				<span>Energy Cost ($)</span>
				<span>Download</span>
			</div>
			<hr>
			<hr>
			<div id="monthly-report-content">
				{% for summary in monthly_summary %}
				<div>
					<span class="summary-date-col">{{summary.dt|date:"M Y"}}</span>
					<span>{{summary.energy_usage|floatformat:"0"|intcomma}}</span>
					<span>{{summary.co2_usage|floatformat:"0"|intcomma}}</span>
					<span>{{summary.money_usage|floatformat:"0"|intcomma}}</span>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>

<div class="report-head">
	<div class="system-name">{{systems.0.name}}</div>
	<hr class="title-separator">
	<div class="report-name"></div>
	<div id="save-report-btn">Save Report</div>
	<hr class="head-separator">
</div>

<div class="report-component">
	<div class="report-component-header">WHAT ARE OUR KEY STATISTICS FOR THIS MONTH</div>
	<hr class="report-component-separator">
	<div class="basic-info-container">
		<div id="current-usage-col" class="basic-info-col">
			<div>HOW MUCH ENERGY<br>DID WE USE?</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="current-energy-usage"></span><span class="basic-info-col-unit"> kWh</span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="current-co2-usage"></span><span class="basic-info-col-unit"> CO<sub>2</sub></span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="current-money-usage"></span>
				</div>
			</div>
		</div>

		<div id="save-usage-col" class="basic-info-col">
			<div>HOW MUCH ENERGY<br>DID WE SAVE?</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="save-energy-usage"></span><br>
					<span id="save-energy-subtext" class="basic-info-col-subtext"></span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="save-co2-usage"></span><br>
					<span id="save-co2-subtext" class="basic-info-col-subtext"></span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="save-money-usage"></span><br>
					<span id="save-money-subtext" class="basic-info-col-subtext"></span>
				</div>
			</div>
		</div>

		<div id="impact-col" class="basic-info-col">
			<div>WHAT WAS OUR<br>ENVIRONMENTAL IMPACT?</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="car-impact"></span><br>
					<span id="car-impact-subtext" class="basic-info-col-subtext"></span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="forest-impact"></span><br>
					<span id="forest-impact-subtext" class="basic-info-col-subtext"></span>
				</div>
			</div>
			<hr class="current-usage-separator-dark-grey">
			<hr class="current-usage-separator-light-grey">
			<div>
				<img src="">
				<div class="basic-info-text-container">
					<span id="elephant-impact-subtext" class="basic-info-col-subtext"></span><br>
					<span id="elephant-impact"></span>
				</div>
			</div>
		</div>
	</div>
	<div class="report-component-footer">
		<div class="hide-details-btn btn-down">HIDE DETAILS</div>
	</div>

	<div class="detail-container">
		<div class="detail-title">
			<span>Usage Type</span>
			<span>Total Energy Consumed (kWh)</span>
			<span>Total CO<sub>2</sub> Emissions (kg)</span>
			<span>Total Money Spent ($)</span>
		</div>
		<hr class="detail-container-separator-dark-grey">
		<hr class="detail-container-separator-light-grey">
		<div id="key-statistic-sub-data"></div>
		<div class="detail-split-title">HOW DOES THAT SPLIT BY PERCENTAGE?</div>
		<hr class="detail-container-separator-dark-grey">
		<hr class="detail-container-separator-light-grey">
		<div class="key-statistics-percentage">
			<div id="energy-donut" class="css3-shadow"></div>
			<div class="donut-center-text">kWh</div>
			<div id="energy-percent-sub-info"></div>
			<div style="clear: both;"></div>
			<div class="percent-other-info">
				<div>• Other:</div>
				<div id="energy-percent-other-info"></div>
			</div>
			<div style="clear: both;"></div>
		</div>
		<div class="key-statistics-percentage">
			<div id="co2-donut" class="css3-shadow"></div>
			<div class="donut-center-text">CO<sub>2</sub></div>
			<div id="co2-percent-sub-info"></div>
			<div style="clear: both;"></div>
			<div class="percent-other-info">
				<div>• Other:</div>
				<div id="co2-percent-other-info"></div>
			</div>
			<div style="clear: both;"></div>
		</div>
		<div class="key-statistics-percentage">
			<div id="money-donut" class="css3-shadow"></div>
			<div class="donut-center-text">Money</div>
			<div id="money-percent-sub-info"></div>
			<div style="clear: both;"></div>
			<div class="percent-other-info">
				<div>• Other:</div>
				<div id="money-percent-other-info"></div>
			</div>
			<div style="clear: both;"></div>
		</div>
	</div>
</div>

<div id="weekday-info" class="report-component calendar-component">
	<div class="report-component-header">HOW MUCH ENERGY DID WE USE ON WEEKDAYS?</div>
	<hr class="report-component-separator">
	<div>
		<div class="calendar-left-info">
			<div class="calendar-average-cell">
				<div>Average<br>Weekday<br>Energy Use:</div>
				<div>
					<div class="average-usage"></div>
					<div class="average-usage-unit">kWh</div>
				</div>
			</div>
			<div class="calendar-left-compare-info compare-beginning">
				<span class="compare-percent"></span><span>%</span>
				<div class="compare-subtext"></div>
			</div>
			<div class="calendar-left-compare-info compare-last">
				<span class="compare-percent"></span><span>%</span>
				<div class="compare-subtext"></div>
			</div>
			<div class="calendar-left-compare-info compare-last-same-period">
				<span class="compare-percent"></span><span>%</span>
				<div class="compare-subtext"></div>
			</div>
		</div>
		<div class="calendar-info-container">
			<div class="calendar-title"></div>
			<hr>
			<div class='calendar-weekday-header'>
				<div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
			</div>
			<div class="calendar-day-container"></div>
			<div class="calendar-legend-container">
				<div class="legend-color-block legend-color-block-better"></div>
				<div class="legend-label">Better than<br>average weekday</div>
				<div class="legend-color-block legend-color-block-worse"></div>
				<div class="legend-label">Worse than<br>average weekday</div>
				<div class="legend-color-block legend-color-block-average"></div>
				<div class="legend-label">Average weekday</div>
			</div>
		</div>
	</div>
	<hr>
	<div class="calendar-bottom-info">
		<div>
			<div>Lowest Weekday Energy Use:</div>
			<div class="lowest-usage-val"></div>
			<div class="lowest-usage-date"></div>
		</div>
		<div>
			<div>Highest Weekday Energy Use:</div>
			<div class="highest-usage-val"></div>
			<div class="highest-usage-date"></div>
		</div>
		<div>
			<div class="energy-split-pie"></div>
			<div class="energy-split-info">
				<div>Energy Split by:</div>
				<div>
					<span>Weekdays: </span><span class="first-split-val"></span>
				</div>
				<div>
					<span>Weekends: </span><span class="second-split-val"></span>
				</div>
			</div>
		</div>
	</div>
	<div class="calendar-footnote">** The first month you started using En-trak</div>
	<div class="report-component-footer">
		<div class="hide-details-btn btn-down">HIDE DETAILS</div>
	</div>

	<div class="detail-container"></div>
	<div style="clear:both;"></div>
</div>

<div class="bottom-save-report-btn">Save Report</div>
<div class="bottom-space"></div>

{% endblock %}
