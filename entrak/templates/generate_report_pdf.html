{% extends "report.html" %}

{% load entrak_extras %}
{% load static %}
{% load humanize %}

{% block extra_head %}
{{block.super}}

<link rel="stylesheet" type="text/css" href="{% static 'css/report-pdf.css' %}">
{% endblock %}

{% block extra_script %}

{% include "report_inner_template.html" %}

<script type="text/javascript">

var report = {};

$(function() {
	report.entrakSystem = new EntrakSystem();
	report.entrakSystem.assignSystemTree('{{systems|jsonifySystems}}');

	report.currentReportType = '{{report_type}}';
	report.timezone = '{{systems.0.timezone}}';
	report.currentDt =  moment.unix({{start_timestamp}}).tz(report.timezone);
	{% ifequal report_type "custom-month" %}
	report.customMonthEndDt = moment.unix({{end_timestamp}}).tz(report.timezone);
	{% else %}
	report.customMonthEndDt = null;
	{% endifequal %}

	report.reportGenerator = new ReportGenerator(report.entrakSystem.systemTree, report.timezone,
		report.currentReportType);
	report.reportGenerator.isPdf = true;
	report.reportGenerator.updateDtInfo(report.currentDt, report.customMonthEndDt);

	$(".report-name").text(report.reportGenerator.genReportName());
	
	report.reportGenerator.assignData(JSON.parse("{{report_data}}"));
	report.reportGenerator.generateFullReport();
});
</script>
{% endblock %}

{% block content %}

<div class="report-head">
	<div class="system-name">{{systems.0.name}}</div>
	<hr class="title-separator">
	<div class="report-name"></div>
	<hr class="head-separator">
</div>

{% include "report_main_content_pdf.html" %}

{% endblock %}
