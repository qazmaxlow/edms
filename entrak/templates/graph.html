{% extends "base.html" %}

{% load staticfiles %}

{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/chart.css' %}">
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script src="{% static 'js/arboreal.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.min.js' %}"></script>
<script src="{% static 'js/growraf/jquery.flot.growraf.js' %}"></script>
<script src="{% static 'js/moment.min.js' %}"></script>
<script src="{% static 'js/graph.js' %}"></script>

<script type="text/javascript">

var graph = null;

$(function() {

	graph = new Graph("#chart", "#source-choice", "#y-axis-slider");
	graph.timezoneOffset = (new Date().getTimezoneOffset())/60;
	graph.currentRangeType = graph.RANGE_TYPE_DAY;
	// TODO: hardcode now
	// graph.currentDt = moment().startOf('hour');
	graph.currentDt = moment().year(2014).month(5).date(3).startOf('hour');

	{% for system in systems %}
		var system = {};
		system.code = '{{system.code}}';
		system.name = '{{system.name}}';
		system.path = '{{system.path}}';
		system.sources = {};
		if (system.path == 'None') {
			graph.systemTree = new Arboreal(null, system);
		} else {
			parentCodes = $(system.path.split(',')).filter(function(){
				return this != "";
			});
			parentCode = parentCodes[parentCodes.length - 1];
			parentNode = graph.systemTree.find(function (node) {
				return node.data.code == parentCode;
			});
			parentNode.appendChild(system);
		}
	{% endfor %}
	graph.currentSelectedSystem = graph.systemTree;

	{% for source in sources %}
		var source = {};
		source.name = '{{source.d_name}}';
		source.name_tc = '{{source.d_name_tc}}';
		source.order = '{{source.order}}';

		graph.addSourceToSystem('{{source.system_code}}', '{{source.id}}', source);
	{% endfor %}

	$("#y-axis-slider").slider({
		orientation: "vertical",
		animate: "fast",
	});

	graph.getSourceReadings();

});

</script>
{% endblock %}

{% block content %}

<div id="chart" class='chart'></div>
<div id="source-choice"></div>
<div id="y-axis-slider"></div>

{% endblock %}
