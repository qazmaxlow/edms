{% extends "page_base.html" %}

{% load static %}
{% load staticfiles %}
{% load entrak_extras %}

{% block extra_head %}
{{block.super}}

<link rel="stylesheet" type="text/css" href="{% static 'css/drop-down-panel.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/graph.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'js/datetimepicker-master/jquery.datetimepicker.css' %}">
<script src="{% static 'js/flot/jquery.flot.min.js' %}"></script>
<script src="{% static 'js/growraf/jquery.flot.growraf.js' %}"></script>
<script src="{% static 'js/tooltip/jquery.flot.tooltip.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.selection-customized.js' %}"></script>
<script src="{% static 'js/morris.js-0.4.3/raphael-min.js' %}"></script>
<script src="{% static 'js/morris.js-0.4.3/morris-customized.js' %}"></script>
<script src="{% static 'js/datetimepicker-master/jquery.datetimepicker-customized.js' %}"></script>
<script src="{% static 'js/jquery-cookie-master/jquery.cookie.js' %}"></script>
<script src="{% static 'js/csrf_ajax.js' %}"></script>
<script src="{% static 'js/entrak-system.js' %}"></script>
<script src="{% static 'js/entrak-utils.js' %}"></script>
<script src="{% static 'js/graph-chart.js' %}"></script>
{% endblock %}

{% block selected-menu-link-id %}menu-link-graph{% endblock %}
{% block system_menu_target_view %}graph{% endblock %}
{% block breadcrumb_target_view %}graph{% endblock %}

{% block extra_script %}
{{block.super}}

<script type="text/javascript">

var graph = {};
graph.sourceChoiceContainerHeight = 0;

function updateDonutChart(data) {
	$("#selection-summary-chart").empty();
	var donutChart = Morris.Donut({
		element: 'selection-summary-chart',
		data: data,
		colors: ['#FFAE20', '#EF7C56', '#35BC99', '#C94CD7', '#587EFF'],
		labelColors: ['#FFAE20', '#EF7C56', '#35BC99', '#C94CD7', '#587EFF'],
		formatter: function (x) { return x + "%"}
	});
	donutChart.on('select', function(i, row){
		$("#selection-summary-value").text(row.orgValue.toFixed(0));
		$("#selection-summary-source").text(row.label);
		$("#selection-summary-source").css("color", donutChart.options.colors[i]);

		if (graph.graphChart.currentUnit.isSuffix) {
			$("#selection-summary-unit-prefix").text('');
			$("#selection-summary-unit-suffix").text(graph.graphChart.currentUnit.shortDesc);
		} else {
			$("#selection-summary-unit-prefix").text(graph.graphChart.currentUnit.shortDesc);
			$("#selection-summary-unit-suffix").text('');
		}
		
	});
	donutChart.fire("select", 0, data[0]);
}

function formatDtAtStr(dt, rangeType) {
	var formatStr = null;
	if (rangeType === Utils.RANGE_TYPE_HOUR
		|| rangeType === Utils.RANGE_TYPE_DAY
		|| rangeType === Utils.RANGE_TYPE_NIGHT) {
		formatStr = 'D MMM YYYY, ddd';
	} else if (rangeType === Utils.RANGE_TYPE_WEEK) {
		formatStr = 'D MMM YYYY';
	} else if (rangeType === Utils.RANGE_TYPE_MONTH) {
		formatStr = 'MMM YYYY';
	}

	return (formatStr !== null) ? dt.format(formatStr) : '';
}

function formatDtStr(dt, rangeType) {
	var formatStr = null;
	if (rangeType === Utils.RANGE_TYPE_HOUR
		|| rangeType === Utils.RANGE_TYPE_DAY
		|| rangeType === Utils.RANGE_TYPE_NIGHT
		|| rangeType === Utils.RANGE_TYPE_WEEK) {
		formatStr = 'D MMM YYYY, ddd';
	} else if (rangeType === Utils.RANGE_TYPE_MONTH) {
		formatStr = 'MMM YYYY';
	} else if (rangeType === Utils.RANGE_TYPE_YEAR) {
		formatStr = 'YYYY';
	}

	return dt.format(formatStr);
}

function formatCompareDtStr(dt, rangeType) {
	var formatStr = null;
	if (rangeType === Utils.RANGE_TYPE_HOUR) {
		formatStr = 'HH:mm D MMM YYYY, ddd';
	} else if (rangeType === Utils.RANGE_TYPE_DAY
		|| rangeType === Utils.RANGE_TYPE_NIGHT
		|| rangeType === Utils.RANGE_TYPE_WEEK) {
		formatStr = 'D MMM YYYY, ddd';
	} else if (rangeType === Utils.RANGE_TYPE_MONTH) {
		formatStr = 'MMM YYYY';
	} else if (rangeType === Utils.RANGE_TYPE_YEAR) {
		formatStr = 'YYYY';
	}

	return dt.format(formatStr);
}

function formatDtFromToStr(dt, rangeType) {
	var formatStr = null;
	if (rangeType === Utils.RANGE_TYPE_HOUR
		|| rangeType === Utils.RANGE_TYPE_DAY
		|| rangeType === Utils.RANGE_TYPE_NIGHT) {
		formatStr = 'hh:mma';
	} else if (rangeType === Utils.RANGE_TYPE_WEEK) {
		formatStr = 'ddd';
	} else if (rangeType === Utils.RANGE_TYPE_MONTH) {
		formatStr = 'D';
	} else if (rangeType === Utils.RANGE_TYPE_YEAR) {
		formatStr = 'MMM';
	}

	return dt.format(formatStr);
}

function updateCurrentDtText() {
	$("#current-dt").text(' ' + formatDtStr(graph.graphChart.currentDt, graph.graphChart.currentRangeType) + ' ');
}

function resetGraphNPanel() {
	$("#source-choice-container input").prop("checked", false);
	graph.graphChart.currentSelectedSourceIdx = [];

	updateCurrentDtText();

	clearCompareChoice();

	var compareHighestLowestContainer = $(".compare-highest-lowest-container");
	if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_NIGHT) {
		compareHighestLowestContainer.find("input").prop('disabled', true);
		compareHighestLowestContainer.addClass('compare-disabled');
	} else {
		compareHighestLowestContainer.find("input").prop('disabled', false);
		compareHighestLowestContainer.removeClass('compare-disabled');
	}

	var compareBetweenText;
	var compareTargetText;
	if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_DAY) {
		compareBetweenText = 'days';
		compareTargetText = graph.graphChart.currentDt.format('dddd');
	} else if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_NIGHT) {
		compareBetweenText = compareTargetText = 'nights';
	} else if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_WEEK) {
		compareBetweenText = compareTargetText = 'weeks';
	} else if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_MONTH) {
		compareBetweenText = compareTargetText = 'months';
	} else if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_YEAR) {
		compareBetweenText = compareTargetText = 'years';
	} else if (graph.graphChart.currentRangeType === Utils.RANGE_TYPE_HOUR) {
		compareBetweenText = compareTargetText = 'hours';
	}
	$("#compare-between").text(compareBetweenText);
	$(".compare-target-text").text(compareTargetText);

	$("#x-axis-slider").slider("values", [0, 0]);

	var selectionSummary = $("#selection-summary");
	if (selectionSummary.css('display') !== 'none') {
		selectionSummary.fadeOut();
	}

	if (graph.graphChart.plot !== null) {
		graph.graphChart.plot.setSelection({
			xaxis: {
				from: 0,
				to: 0,
			}
		});
	}
}

function retrieveReadingFinished() {
	resetGraphNPanel();
}

function retrieveSummaryFinished() {
	$("#last-consumption-val").text(graph.graphChart.lastConsumption.toFixed(0));
	$("#this-consumption-val").text(graph.graphChart.realtimeConsumption.toFixed(0));

	var diffPercentage = ((Math.abs(graph.graphChart.realtimeConsumption - graph.graphChart.lastConsumption)/graph.graphChart.realtimeConsumption)*100).toFixed(1);
	$("#summary-percentage-number").text(diffPercentage);

	var summaryBgImg = null;
	if (graph.graphChart.lastConsumption > graph.graphChart.realtimeConsumption) {
		summaryBgImg = "{% static 'images/summary-lower.png' %}";
	} else if (graph.graphChart.lastConsumption < graph.graphChart.realtimeConsumption) {
		summaryBgImg = "{% static 'images/summary-higher.png' %}";
	} else {
		summaryBgImg = "{% static 'images/summary-neutral.png' %}";
	}
	$("#summary-image").css("background-image", 'url(' + summaryBgImg + ')');

	setTimeout(function() {
		graph.graphChart.getSummary(retrieveSummaryFinished);
	}, 60000);
}

function setupSourceChoice() {
	var choiceContainer = $("#source-choice-container");
	choiceContainer.empty();

	var sourceNames = [];
	$.each(graph.graphChart.entrakSystem.systemTree.children, function(idx, subSystem) {
		sourceNames.push(subSystem.data.name);
	});
	$.each(graph.graphChart.entrakSystem.systemTree.data.sources, function(sourceIdx, source) {
		sourceNames.push(source.name);
	});

	graph.sourceChoiceContainerHeight = Math.ceil(sourceNames.length/4.0)*22 + 100;

	$.each(sourceNames, function(seriesIdx, sourceName) {
		var choiceHtml = "<div>";
		var checkboxId = "source-checkbox-" + seriesIdx;
		choiceHtml += "<div class='circle-checkbox'><input id='" + checkboxId + "'"
			+ "' type='checkbox' " + "series_idx='" + seriesIdx + "'"
			+ " name='" + sourceName + "'"
			+ " ></input>"
			+ "<label for='" + checkboxId + "'></label></div>"
			+ "<label class='source-label' for='" + checkboxId + "'>" + sourceName + "</label>"
			+ "</div>";
		choiceContainer.append(choiceHtml);
	});

	choiceContainer.find("input").click(function () {
		if (choiceContainer.find("input:checked").length >= 5) {
			choiceContainer.find("input:not(:checked)").prop('disabled', true);
			choiceContainer.find("input:not(:checked)").parent().parent().find(".source-label").addClass('source-label-disabled');
		} else {
			choiceContainer.find("input").prop('disabled', false);
			choiceContainer.find(".source-label").removeClass('source-label-disabled');
		}

		var selectedSeriesIdxs = [];

		choiceContainer.find("input:checked").each(function () {
			var seriesIdx = parseInt($(this).attr("series_idx"), 10);
			selectedSeriesIdxs.push(seriesIdx);
		});

		graph.graphChart.updateSourceChoice(selectedSeriesIdxs);
	});

	$("#source-choice-clear").click(function() {
		choiceContainer.find("input").prop('disabled', false).prop('checked', false);
		choiceContainer.find(".source-label").removeClass('source-label-disabled');
		graph.graphChart.updateSourceChoice([]);
	});
}

function clearCompareChoice() {
	$(".compare-choice-block input").prop("checked", false);
	graph.graphChart.showLast = false;
	graph.graphChart.showHighest = false;
	graph.graphChart.showLowest = false;
	graph.graphChart.showCustom = false;
	graph.graphChart.customDt = null;
	$("#compare-prev-date").text(formatCompareDtStr(graph.graphChart.lastStartEndDt.startDt, graph.graphChart.currentRangeType));
	$("#compare-highest-date").text("");
	$("#compare-lowest-date").text("");
	$("#compare-custom-date").text("");

	$(".compare-choice-block input").prop("checked", false);
}

function setupComparePanel() {
	$("#compare-prev-checkbox").click(function() {
		if ($(this).prop("checked")) {
			graph.graphChart.showLast = true;
			graph.graphChart.getLastSourceReadings();
		} else {
			graph.graphChart.showLast = false;
			graph.graphChart.updateCompareChoice();
		}
	});

	$("#compare-highest-checkbox").click(function() {
		if ($(this).prop("checked")) {
			graph.graphChart.showHighest = true;
			graph.graphChart.getHighestSourceReadings(function () {
				$("#compare-highest-date").text(formatCompareDtStr(graph.graphChart.highestDt, graph.graphChart.currentRangeType));
			});
		} else {
			graph.graphChart.showHighest = false;
			graph.graphChart.updateCompareChoice();
			$("#compare-highest-date").text("");
		}
	});

	$("#compare-lowest-checkbox").click(function() {
		if ($(this).prop("checked")) {
			graph.graphChart.showLowest = true;
			graph.graphChart.getLowestSourceReadings(function () {
				$("#compare-lowest-date").text(formatCompareDtStr(graph.graphChart.lowestDt, graph.graphChart.currentRangeType));
			});
		} else {
			graph.graphChart.showLowest = false;
			graph.graphChart.updateCompareChoice();
			$("#compare-lowest-date").text("");
		}
	});

	$("#compare-custom-checkbox").click(function() {
		if ($(this).prop("checked")) {
			graph.graphChart.showCustom = true;
			if (graph.graphChart.customDt !== null) {
				graph.graphChart.getCustomSourceReadings();
			}
		} else {
			graph.graphChart.showCustom = false;
			graph.graphChart.updateCompareChoice();
		}
	});

	$("#compare-choice-clear").click(function() {
		clearCompareChoice();
		graph.graphChart.updateCompareChoice();
	});
}

$(function() {
	setupAjaxForCsrf($.cookie('csrftoken'));

	graph.graphChart = new GraphChart(
		"#chart",
		"#y-axis-slider",
		"#x-axis-slider",
		retrieveReadingFinished);
	graph.graphChart.currentRangeType = Utils.RANGE_TYPE_DAY;
	graph.graphChart.currentDt = Utils.getNowMoment('hour');

	graph.graphChart.entrakSystem = new EntrakSystem();
	graph.graphChart.entrakSystem.assignSystemTree('{{systems|jsonifySystems}}');
	graph.graphChart.currentSelectedSystem = graph.graphChart.entrakSystem.systemTree;

	graph.graphChart.entrakSystem.addSourceToSystem('{{sources|jsonifySources}}');

	graph.unitCategorys = JSON.parse('{{unit_categorys|jsonifyUnitCategorys}}');
	graph.graphChart.currentUnit = graph.unitCategorys[0];

	$("#unit-label").text(graph.unitCategorys[0].name);
	$("#unit-bg").attr("src", "{% get_static_prefix %}images/unit/" + graph.unitCategorys[0].bgImg);

	$("#y-axis-slider").slider({
		orientation: "vertical",
		animate: "fast",
		create: function(event, ui) {
			var wrapDiv = $('<div>')
			wrapDiv.append($(this).find('a'));
			$(this).append(wrapDiv);
		}
	});

	$("#x-axis-slider").slider({
		range: true,
		min: 0,
		values: [0, 0],
		step: 1,
		animate: "fast",
	});
	graph.graphChart.xAxisSliderCallback = function (ranges, fromDt, toDt, data) {
		var selectionSummary = $("#selection-summary");
		if (fromDt.unix() === toDt.unix()) {
			if (selectionSummary.css('display') !== 'none') {
				selectionSummary.fadeOut();
			}
		} else {
			if (selectionSummary.css('display') === 'none') {
				selectionSummary.fadeIn();
			}
			$("#selection-summary-at span").text(formatDtAtStr(graph.graphChart.currentDt, graph.graphChart.currentRangeType));
			$("#selection-summary-from span").text(formatDtFromToStr(fromDt, graph.graphChart.currentRangeType));
			$("#selection-summary-to span").text(formatDtFromToStr(toDt, graph.graphChart.currentRangeType));

			var total = data.reduce(function (previousVal, current, index, array) {
				return previousVal + current.value;
			}, 0);
			var transformedData = data.map(function (seriesData) {
				var percentage = Math.round((seriesData.value/total)*1000)/10;
				return {label: seriesData.label, value: percentage, orgValue: seriesData.value};
			});
			transformedData.sort(function (a, b) {
				return b.orgValue - a.orgValue;
			});
			updateDonutChart(transformedData);
		}
	};

	setupSourceChoice();
	setupComparePanel();

	var subMenuPanel = $(".drop-down-panel-content ul");
	$(".panel-header-left-menu h3").each(function (eleIdx) {
		$(this).click({connectedPanel: subMenuPanel[eleIdx]}, function (event) {
			var connectedPanel = $(event.data.connectedPanel);
			if (!(connectedPanel.hasClass('selected-submenu'))) {
				subMenuPanel.filter(".selected-submenu").removeClass('selected-submenu').hide();
				connectedPanel.addClass('selected-submenu').fadeIn();
			}

			if ($(connectedPanel).attr('id') === "source-choice") {
				$(".drop-down-panel-content").height(graph.sourceChoiceContainerHeight + "px");
			} else if ($(connectedPanel).attr('id') === "day-choice") {
				$(".drop-down-panel-content").height("125px");
			} else {
				$(".drop-down-panel-content").height("95px");
			}

			var menuLinks = $('.drop-down-panel-content');
			if (menuLinks.css("display") === 'none') {
				menuLinks.slideToggle(700, "easeOutBounce", function() {});
				$('.expand-drop-down-panel-btn').css({transform: 'rotate(180deg)'});
			}
		});
	});
	$("#unit-choice").addClass('selected-submenu').show();

	Utils.setupDropDownPanelBtn();

	Utils.setupUnitChoiceLayout('#unit-choice', graph.unitCategorys, '{% get_static_prefix %}', function(unitCategory) {
		graph.graphChart.updateUnit(unitCategory);
		$("#unit-label").text(unitCategory.name);
		$("#unit-bg").attr("src", "{% get_static_prefix %}images/unit/" + unitCategory.bgImg);
	});

	Utils.setupTimeChoiceLayout('#time-choice', function(newRangeType) {
		if (graph.graphChart.currentRangeType !== newRangeType) {
			graph.graphChart.currentDt = Utils.genStartEndDt(Utils.getNowMoment('hour'), newRangeType).startDt;
			graph.graphChart.updateCurrentRangeType(newRangeType);
			resetGraphNPanel();
		}
	});

	graph.graphChart.getSourceReadings();

	Date.parseDate = function( input, format ){
		return moment(input,format).toDate();
	};
	Date.prototype.dateFormat = function( format ){
		return moment(this).format(format);
	};

	var dtPickerFormat = "D MMM YYYY, dddd";
	$("#compare-dt-picker").datetimepicker({
		format: dtPickerFormat,
		formatTime: "h:mm a",
		formatDate: "DD.MM.YYYY",
		scrollMonth: false,
		timepicker: false,
		onSelectDate: function(input) {
			graph.graphChart.updateCompareDt(moment(input).startOf('hour'));
			$("#compare-custom-date").text(formatCompareDtStr(graph.graphChart.customDt.startDt, graph.graphChart.currentRangeType))
			if (graph.graphChart.showCustom) {
				graph.graphChart.getCustomSourceReadings();
			}
		}
	});
	$("#compare-calendar-icon").click(function () {
		$('#compare-dt-picker').datetimepicker('show');
	})

	var dtPickerFormat = "D MMM YYYY, dddd";
	$("#current-dt-picker").datetimepicker({
		format: dtPickerFormat,
		formatTime: "h:mm a",
		formatDate: "DD.MM.YYYY",
		scrollMonth: false,
		timepicker: false,
		onSelectDate: function(input) {
			graph.graphChart.updateCurrentDt(moment(input).startOf('hour'));
			resetGraphNPanel();
		}
	});
	$("#custom-calendar-icon").click(function () {
		$('#current-dt-picker').datetimepicker('show');
	})

	$("#dt-prev-icon").click(function () {
		graph.graphChart.goPrev();
		resetGraphNPanel();
	});
	$("#dt-next-icon").click(function () {
		graph.graphChart.goNext();
		resetGraphNPanel();
	});
	$("#dt-now-icon").click(function() {
		graph.graphChart.updateCurrentDt(Utils.getNowMoment('hour'));
		resetGraphNPanel();
	});

	$("#clear-graph").click(function () {
		resetGraphNPanel();
	});

	resetGraphNPanel();

	graph.graphChart.getSummary(retrieveSummaryFinished);
});

</script>
{% endblock %}

{% block page_title %}THE GRAPH SECTION{% endblock %}
{% block page_subtitle %}Check this out!{% endblock %}

{% block page_content %}
<div class="panel-component">
	<div id="graph-panel-header" class="drop-down-panel-header">
		<!-- Sub Menu Item -->
		<div class="panel-header-left-menu">
			<!-- write this way to remove space between inline-blocks -->
			<!-- http://css-tricks.com/fighting-the-space-between-inline-block-elements/ -->
			<h3 id="sub-menu-unit">
				Unit</h3><h3 id="sub-menu-time">
				Time</h3><h3 id="sub-menu-source">
				End-use</h3><h3 id="sub-menu-days">Compare</h3>
			<img class="expand-drop-down-panel-btn" src="{% static 'images/expandable_button.png' %}">
		</div>

		<!-- Date -->
		<div id="dt-panel">
			<div id="dt-next-icon"></div>
			<div id="dt-now-icon"></div>
			<div id="dt-prev-icon"></div>
			<span id="current-dt"></span>
			<span style='clear: both;'></span>
		</div>
	</div>

	<!-- Sub Menu Item Links -->
	<div class="drop-down-panel-content">
		<ul id="unit-choice"></ul>
		<ul id="time-choice">
			<div id="select-dt-section">
				<div id="custom-select-title">CUSTOM SELECT</div>
				<div id="custom-calendar-icon"></div>
				<input type="text" id="current-dt-picker">
			</div>
		</ul>
		<ul id="source-choice">
			<div class="choice-panel">
				<div class="choice-header">Compare between Sources 
					<span style="font-weight: lighter; font-size: 12px;">(Max 5)</span>
					<span id="source-choice-clear" class="choice-clear">Clear all</span>
				</div>
				<hr>
				<div id="source-choice-container"></div>
				<div style="clear: both;"></div>
			</div>
		</ul>
		<ul id="day-choice">
			<div class="choice-panel">
				<div class="choice-header">Compare between <span id="compare-between">days</span>
					<span id="compare-choice-clear" class="choice-clear">Clear all</span>
				</div>
				<hr>
				<div class="compare-choice-block">
					<div>
						<div class='circle-checkbox'>
							<input type='checkbox' id="compare-prev-checkbox"></input>
							<label for="compare-prev-checkbox"></label>
						</div>
						<label for="compare-prev-checkbox" style="color: #F7AF25;">Previous <span class="compare-target-text"></span></label>
					</div>
					<div>
						<img src="{% static 'images/compare-previous.png' %}">
						<span id="compare-prev-date"></span>
					</div>
				</div>
				<div class="compare-choice-block" style="left: 200px;">
					<div class="compare-highest-lowest-container">
						<div class='circle-checkbox'>
							<input type='checkbox' id="compare-highest-checkbox"></input>
							<label for="compare-highest-checkbox"></label>
						</div>
						<label for="compare-highest-checkbox" style="color: #ED6D43;">Highest <span class="compare-target-text"></span></label>
					</div>
					<div>
						<img src="{% static 'images/compare-highest.png' %}">
						<span id="compare-highest-date"></span>
					</div>
				</div>
				<div class="compare-choice-block" style="left: 400px;">
					<div class="compare-highest-lowest-container">
						<div class='circle-checkbox'>
							<input type='checkbox' id="compare-lowest-checkbox"></input>
							<label for="compare-lowest-checkbox"></label>
						</div>
						<label for="compare-lowest-checkbox" style="color: #35BC99;">Lowest <span class="compare-target-text"></span></label>
					</div>
					<div>
						<img src="{% static 'images/compre-lowest.png' %}">
						<span id="compare-lowest-date"></span>
					</div>
				</div>
				<div class="compare-choice-block" style="left: 600px;">
					<div>
						<div class='circle-checkbox'>
							<input type='checkbox' id="compare-custom-checkbox"></input>
							<label for="compare-custom-checkbox"></label>
						</div>
						<label for="compare-custom-checkbox" style="color: #587EFF;">Custom date selection</label>
					</div>
					<div>
						<img id="compare-calendar-icon" src="{% static 'images/compare-calendar.png' %}">
						<input type="text" id="compare-dt-picker">
						<span id="compare-custom-date"></span>
					</div>
				</div>
			</div>
		</ul>
	</div>
	<div style="clear: both;"></div>

	<!-- Simple bar for decoration -->
	<div class="panel-separator"></div>
</div>

<!-- Main Graph -->
<div id="graph-panel" class="panel-component">
	<img id="unit-bg">
	<div id="chart"></div>
	<div id="y-axis-slider"></div>
	<div id="x-axis-slider"></div>

	<div id="selection-summary">
		<div id="selection-summary-left">
			<p id="selection-summary-at">Amount of energy consumed on: <span></span></p>
			<p id="selection-summary-from">from:<span></span></p>
			<p id="selection-summary-to">to:<span></span></p>
			<p id="selection-summary-line"></p>
			<!-- <p id="selection-summary-equal">which equates to:</p> -->
			<p id="selection-summary-value-container">
				<span id="selection-summary-unit-prefix"></span>
				<span id="selection-summary-value"></span>
				<span id="selection-summary-unit-suffix"></span>
			</p>
		</div>
		<div id="selection-summary-right">
			<div id="selection-summary-chart"></div>
			<p id="selection-summary-source"></p>
		</div>
		<p style="clear: both;"></p>
	</div>

	<div id="unit-label"></div>
</div>
<!-- Main Graph Ends -->

<!-- Summary -->
<div id="summary">
	<div id="summary-header"><img src="{% static 'images/summary.png' %}"></div>

	<div id="summary-image">
		<div id="last-summary">
			<p class="summary-text">This time last week you had used </p>
			<img class="electricity-icon" src="{% static 'images/red-electricity.png' %}">
			<span id="last-consumption-val" class="consumption-val"></span><span class="consumption-unit">kwh</span>
		</div>

		<div id="this-summary">
			<p class="summary-text">So far today you have used </p>
			<img class="electricity-icon" src="{% static 'images/green-electricity.png' %}">
			<span id="this-consumption-val" class="consumption-val"></span><span class="consumption-unit">kwh</span>
		</div>

		<div id="summary-percentage">
			<span id="summary-percentage-number"></span>
			<span id="summary-percentage-symbol">%</span>
		</div>
	</div>

	<a href="{% url 'progress' system_code=systems.0.code %}">See Details &#9654;</a>
</div>
{% endblock %}
