{% extends "base.html" %}

{% load i18n %}
{% load entrak_extras %}
{% load static %}
{% load humanize %}

{% block ga_page_title %}report{% endblock %}

{% block extra_head %}
{{block.super}}
{% get_current_language as LANGUAGE_CODE %}

<link rel="stylesheet" type="text/css" href="{% static 'css/drop-down-panel.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/popup_report.css' %}">
<script src="{% static 'js/jquery-cookie-master/jquery.cookie.js' %}"></script>
<script src="{% static 'js/csrf_ajax.js' %}"></script>
<script src="{% static 'js/moment-with-locales.js' %}"></script>
<script src="{% static 'js/moment-timezone-with-data.min.js' %}"></script>
<script src="{% static 'js/mustache.js-master/mustache.js' %}"></script>
<script src="{% static 'js/jquery.tinysort.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.pie.min.js' %}"></script>
<script src="{% static 'js/entrak-system.js' %}"></script>
<script src="{% static 'js/entrak-utils.js' %}"></script>
<script src="{% static 'js/report-generator.js' %}"></script>

<link href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/kendoui/styles/kendo.common.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/kendoui/styles/kendo.default.min.css' %}" rel="stylesheet">
<!-- Because now using jquery v1.11 -->
<script src="{% static 'assets/kendoui/js/jquery.min.js' %}"></script>
<script src="{% static 'assets/kendoui/js/angular.min.js' %}"></script>
<script src="{% static 'assets/kendoui/js/kendo.all.min.js' %}"></script>

{% endblock %}

{% block selected-menu-link-id %}menu-link-report{% endblock %}
{% block system_menu_target_view %}report{% endblock %}
{% block breadcrumb_target_view %}report{% endblock %}

{% block page_title %}{% trans "THE REPORTS PAGE" %}{% endblock %}
{% block page_subtitle %}{% trans "Get all your information here at the" %}{% endblock %}

{% block extra_script %}
{{block.super}}
{% get_current_language as LANGUAGE_CODE %}

{% include "report_inner_template.html" %}


{% endblock %}

{% block content %}

    <div ng-app="Entrak" class="container">
    <div ng-controller="ReportController">
        <button ng-click="win2.close()" ng-show="win2visible">close</button>
        <div kendo-window="win2"
            k-title="false"
            k-width="600" k-height="200" k-visible="false"
            k-content="{ url: '../report/popup-report/' }"
            k-on-open="win2visible = true" k-on-close="win2visible = false">
        </div>



<div class="report-head">
        <div class="system-name">{{ company_system.fullname }}</div>
        <hr class="title-separator">
        <div class="report-name">{{ report_date|date:"M Y" }} - Monthly Energry Report</div>
        <div class="save-report-btn">{% trans "Save Report" %}</div>
        <div class="save-summary-report-btn">{% trans "Save Summary Report" %}</div>
        <hr class="head-separator">
</div>

<div class="report-component">
    <div class="row report-component-header">
      <div class="col-xs-12">
      {% trans 'WHAT ARE OUR KEY STATISTICS FOR THIS <span class="report-type-name"></span>?' %}</div>
    </div>
    <div class="row basic-info-container">
        <div id="current-usage-col" class="col-xs-4 basic-info-col">
            <div>{% trans "HOW MUCH ENERGY<br>DID WE USE?" %}</div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/lightning-energy.png' %}">
                <div class="basic-info-text-container">
                    <span id="current-energy-usage">{{ total_energy|floatformat:"0" }}</span><span class="basic-info-col-unit"> kWh</span>
                    <br>
                    <span class="basic-info-col-subtext">{% trans "of electricity" %}</span>
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/factory-co2.png' %}">
                <div class="basic-info-text-container">
                    <span id="current-co2-usage"></span>{% blocktrans %}<span class="basic-info-col-unit"> CO<sub>2</sub></span>
                    <br>
                    <span class="basic-info-col-subtext">emitted</span>{% endblocktrans %}
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/piggy.png' %}">
                <div class="basic-info-text-container">
                    <span id="current-money-usage"></span>
                    <br>
                    <span class="basic-info-col-subtext">{% trans "in energy costs" %}</span>
                </div>
            </div>
        </div>

        <div id="save-usage-col" class="col-xs-4 basic-info-col">
            <div>{% trans "HOW MUCH ENERGY<br>DID WE SAVE?" %}<br>
                <span class="basic-info-col-subtext">{% trans "(year-on-year)" %}</span>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/lightning-energy.png' %}">
                <div class="basic-info-text-container">
                    <span id="save-energy-usage"></span>
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/factory-co2.png' %}">
                <div class="basic-info-text-container">
                    <span id="save-co2-usage"></span>
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/piggy.png' %}">
                <div class="basic-info-text-container">
                    <span id="save-money-usage"></span>
                </div>
            </div>
        </div>

        <div id="impact-col" class="col-xs-4 basic-info-col">
            <div>{% trans "HOW DID OUR<br>CARBON FOOTPRINT CHANGE?" %}</div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/car.png' %}">
                <div class="basic-info-text-container">
                    <span id="car-impact"></span><br>
                    <span id="car-impact-subtext" class="basic-info-col-subtext"></span>
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/trees.png' %}">
                <div class="basic-info-text-container">
                    {% ifequal LANGUAGE_CODE 'zh-tw' %}
                    <span id="forest-impact-subtext" class="basic-info-col-subtext"></span><br>
                    <span id="forest-impact"></span>
                    {% else %}
                    <span id="forest-impact"></span><br>
                    <span id="forest-impact-subtext" class="basic-info-col-subtext"></span>
                    {% endifequal %}
                </div>
            </div>
            <hr class="current-usage-separator-dark-grey">
            <hr class="current-usage-separator-light-grey">
            <div>
                <img src="{% static 'images/report/panda.png' %}">
                <div class="basic-info-text-container">
                    <span id="panda-impact-subtext" class="basic-info-col-subtext"></span><br>
                    <span id="panda-impact"></span>
                </div>
            </div>
        </div>
    </div>
    {% block hide_detail_bar_1 %}
    <div class="row report-component-footer"></div>
    {% endblock %}


<div class="detail-container">
    <h4>{% trans "How did that break down by usage type?" %}</h4>
    <table>
      <thead>
        <tr class="detail-title">
            <th>
                {% trans "Usage Type" %}</th><th>
                {% trans "Total Energy (kWh)" %}</th><th>
                {% trans "Total CO<sub>2</sub> (kg)" %}</th><th>
                {% trans "Total Money ($)" %}</th>
            <th>{% trans "% Change in kWh" %}<br>{% trans "Year-on-year" %}</th>
            <th>{% trans "Change in Money" %}<br>{% trans "Year-on-year" %}</th>
        </tr>
      </thead>
      <tbody id="key-statistic-sub-data">
      </tbody>
    </table>
        <hr class="detail-container-separator-dark-grey">
        <hr class="detail-container-separator-light-grey">

        <div class="detail-split-title">{% trans "HOW DOES THAT SPLIT BY PERCENTAGE?" %}</div>
        <hr class="detail-container-separator-dark-grey">
        <hr class="detail-container-separator-light-grey">
        <div class="key-statistics-percentage">
            <div class="key-stat-donut-container">
                <div id="energy-donut"></div>
                <div class="donut-center-text">kWh</div>
            </div>
            <div class="key-stat-percent-separator"></div>
            {% block donut_legend_container %}
            <div class="donut-legend-container donut-legend-container-center"></div>
            {% endblock %}
        </div>
    </div>
</div>

<div id="compare-past" class="report-component">
    <div class="report-component-header">{% trans 'HOW MUCH MORE / LESS DID WE USE COMPARED TO LAST <span class="report-type-name"></span>?' %}</div>
    <div class="compare-past-basic-info">
        {% blocktrans %}
        <div class="compare-past-desc">Your energy consumption this<br><span class="report-type-name-lower"></span> was 
            <span>
                <span class="compare-past-percent"></span>
                <span class="percent-symbol">%</span>
                <span class="compare-past-percent-suffix"></span>
            </span> 
            than<br> it was last <span class="report-type-name-lower"></span>. <span class="footnote-sybmol">*</span>
        </div>
        {% endblocktrans %}
        <div class="compare-past-chart-info">
            <div class="compare-past-chart-title">{% trans 'Total energy consumption for the last 6 <span class="report-type-name-lower-plural"></span>' %}</div>
            <hr>
            <div class="compare-past-chart-subtitle">(kWh)</div>
            <hr>
            <div class="compare-past-chart">
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
                <div class="compare-past-bar-container">
                    <div class="compare-past-bar-val"></div>
                    <div class="compare-past-bar"></div>
                </div>
            </div>
        </div>
        <hr>
        <div class="compare-past-bar-name-container">
            <span class="compare-past-bar-name"></span>
            <span class="compare-past-bar-name"></span>
            <span class="compare-past-bar-name"></span>
            <span class="compare-past-bar-name"></span>
            <span class="compare-past-bar-name"></span>
            <span class="compare-past-bar-name"></span>
        </div>
        <div class="asterisk-text single-asterisk-text">{% trans "* Data not available or incomplete for this period" %}</div>
    </div>
    {% block hide_detail_bar_2 %}
    <div class="report-component-footer"></div>
    {% endblock %}

    <div class="detail-container">
        <div class="detail-split-title">{% trans "WHEN DID WE ACHIEVE OUR SAVINGS?" %}</div>
        <hr>
        <div class="line-chart-title-container">
            <span class="line-chart-title">{% trans "Total consumption by days" %}</span>
        </div>
        <div class="compare-past-line-chart"></div>
        <span class="y-axis-title">kWh</span>
        <div class="x-axis-title">{% trans 'Day of the <span class="report-type-name-lower"></span>' %}</div>
        <hr>
        <div class="compare-past-sub-info-container"></div>
        <div style="clear: both;"></div>
    </div>
</div>

<div id="weekday-info" class="report-component calendar-component">
    <div class="row report-component-header">
      <div class="col-xs-12">
        {% trans "HOW MUCH ENERGY DID WE USE ON <span>WEEKDAYS?</span>" %}</div>
    </div>
    <div class="row">
        <div class="col-xs-4 calendar-left-info">
          <div class="row"><div class="col-xs-12">
              r1
          </div></div>
          <div class="row"><div class="col-xs-12">
              r2
          </div></div>
          <div class="row"><div class="col-xs-12">
              r3
          </div></div>
            <div class="calendar-average-cell">
                <div>{% trans "Average<br>Weekday<br>Energy Use:" %}</div>
                <div>
                  {{ weekday_average|stringformat:"d" }}
                    <div class="average-usage"></div>
                    <div class="average-usage-unit">kWh</div>
                </div>
            </div>

            <hr class="separator-dark-grey">
            <hr class="separator-light-grey">

            <div class="calendar-left-compare-info compare-beginning">
                <div>
                  {% if weekday_compare_last_month > 0 %}
                    {{ weekday_compare_last_month|floatformat:0 }}
                  {% else %}
                    {{ weekday_compare_last_month|floatformat:0|slice:"1:" }}
                  {% endif %}
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last-same-period">
                <div>
                  {% if weekday_compare_same_period > 0 %}
                    {{ weekday_compare_same_period|floatformat:0 }}
                  {% else %}
                    {{ weekday_compare_same_period|floatformat:0|slice:"1:" }}
                  {% endif %}
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
        </div>
        <div class="col-xs-8">
        <div class="calendar-info-container">
            <div class="calendar-title"></div>
            <hr>
            <div class='calendar-weekday-header'>
                {% trans "<div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>" %}
            </div>
            <div class="calendar-day-container"></div>
            <div></div>
            <div class="calendar-legend-container">
                <div class="legend-color-block legend-color-block-better"></div>
                <div class="legend-label">{% trans "Better than<br>average weekday" %}</div>
                <div class="legend-color-block legend-color-block-worse"></div>
                <div class="legend-label">{% trans "Worse than<br>average weekday" %}</div>
                <div class="legend-color-block legend-color-block-average"></div>
                <div class="legend-label">{% trans "Average weekday" %}</div>
            </div>
        </div></div>
        <div class="calendar-vertical-info">
            <div class="calendar-title"></div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Lowest Weekday Energy Use:" %}</div>
            <div>
                <div class="usage-info-lowest-val-container">
                    <span class="lowest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="lowest-usage-date"></div>
            </div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Highest Weekday Energy Use:" %}</div>
            <div>
                <div class="usage-info-highest-val-container">
                    <span class="highest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="highest-usage-date"></div>
            </div>
            <hr>
            <div>
                <div class="energy-split-by-text">{% trans "Energy Split by:" %}</div>
                <div class="energy-split-pie"></div>
                <div class="energy-split-by-info">
                    <div>
                        <span class="first-split-text">{% trans "Weekdays: " %}</span><span class="first-split-val"></span>
                    </div>
                    <div>
                        <span class="second-split-text">{% trans "Weekends: " %}</span><span class="second-split-val"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="bottom-info-separator">
    <div class="calendar-bottom-info">
        <div>
            <div>{% trans "Lowest Weekday Energy Use:" %}</div>
            <div class="usage-info-lowest-val-container">
                <span class="lowest-usage-val"></span><span> kWh</span>
            </div>
            <div class="lowest-usage-date"></div>
        </div>
        <div>
            <div>{% trans "Highest Weekday Energy Use:" %}</div>
            <div class="usage-info-highest-val-container">
                <span class="highest-usage-val"></span><span> kWh</span>
            </div>
            <div class="highest-usage-date"></div>
        </div>
        <div>
            <div class="energy-split-pie"></div>
            <div class="energy-split-info">
                <div>{% trans "Energy Split by:" %}</div>
                <div>
                    <span>{% trans "Weekdays: " %}</span><span class="first-split-val"></span>
                </div>
                <div>
                    <span>{% trans "Weekends: " %}</span><span class="second-split-val"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="not-available-footnote">{% trans "* Data not available or incomplete for this period" %}</div>
    <div class="calendar-footnote">{% trans "** The first month you started using En-trak" %}</div>
    {% block hide_detail_bar_3 %}
    <div class="report-component-footer"></div>
    {% endblock %}

    <div class="detail-container"></div>
    <div style="clear:both;"></div>
</div>

<div id="weekend-info" class="report-component calendar-component">
    <div class="report-component-header">{% trans "HOW MUCH ENERGY DID WE USE ON <span>WEEKENDS AND HOLIDAYS?</span>" %}</div>
    <div>
        <div class="calendar-left-info">
            <div class="calendar-average-cell">
                <div>{% trans "Average<br>Weekend<br>Energy Use:" %}</div>
                <div>
                    <div class="average-usage"></div>
                    <div class="average-usage-unit">kWh</div>
                </div>
            </div>

            <hr class="separator-dark-grey">
            <hr class="separator-light-grey">

            <div class="calendar-left-compare-info compare-beginning">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last-same-period">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
        </div>
        <div class="calendar-info-container">
            <div class="calendar-title"></div>
            <hr>
            <div class='calendar-weekday-header'>
                {% trans "<div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>" %}
            </div>
            <div class="calendar-day-container"></div>
            <div></div>
            <div class="calendar-legend-container">
                <div class="legend-color-block legend-color-block-better"></div>
                <div class="legend-label">{% trans "Better than<br>average weekend" %}</div>
                <div class="legend-color-block legend-color-block-worse"></div>
                <div class="legend-label">{% trans "Worse than<br>average weekend" %}</div>
                <div class="legend-color-block legend-color-block-average"></div>
                <div class="legend-label">{% trans "Average weekend" %}</div>
            </div>
        </div>
        <div class="calendar-vertical-info">
            <div class="calendar-title"></div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Lowest Weekend Energy Use:" %}</div>
            <div>
                <div class="usage-info-lowest-val-container">
                    <span class="lowest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="lowest-usage-date"></div>
            </div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Highest Weekend Energy Use:" %}</div>
            <div>
                <div class="usage-info-highest-val-container">
                    <span class="highest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="highest-usage-date"></div>
            </div>
            <hr>
            <div>
                <div class="energy-split-by-text">{% trans "Energy Split by:" %}</div>
                <div class="energy-split-pie"></div>
                <div class="energy-split-by-info">
                    <div>
                        <span class="first-split-text">{% trans "Weekdays: " %}</span><span class="first-split-val"></span>
                    </div>
                    <div>
                        <span class="second-split-text">{% trans "Weekends: " %}</span><span class="second-split-val"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="bottom-info-separator">
    <div class="calendar-bottom-info">
        <div>
            <div>{% trans "Lowest Weekend Energy Use:" %}</div>
            <div class="usage-info-lowest-val-container">
                <span class="lowest-usage-val"></span><span> kWh</span>
            </div>
            <div class="lowest-usage-date"></div>
        </div>
        <div>
            <div>{% trans "Highest Weekend Energy Use:" %}</div>
            <div class="usage-info-highest-val-container">
                <span class="highest-usage-val"></span><span> kWh</span>
            </div>
            <div class="highest-usage-date"></div>
        </div>
        <div>
            <div class="energy-split-pie"></div>
            <div class="energy-split-info">
                <div>{% trans "Energy Split by:" %}</div>
                <div>
                    <span>{% trans "Weekdays: " %}</span><span class="first-split-val"></span>
                </div>
                <div>
                    <span>{% trans "Weekends: " %}</span><span class="second-split-val"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="not-available-footnote">{% trans "* Data not available or incomplete for this period" %}</div>
    <div class="calendar-footnote">{% trans "** The first month you started using En-trak" %}</div>
    {% block hide_detail_bar_4 %}
    <div class="report-component-footer"></div>
    {% endblock %}

    <div class="detail-container"></div>
    <div style="clear:both;"></div>
</div>

<div id="overnight-info" class="report-component calendar-component">
    <div class="report-component-header">{% trans "HOW MUCH ENERGY DID WE USE <span>OVERNIGHT***?</span>" %}</div>
    <div>
        <div class="calendar-left-info">
            <div class="calendar-average-cell">
                <div>{% trans "Average<br>Overnight<br>Energy Use:" %}</div>
                <div>
                    <div class="average-usage"></div>
                    <div class="average-usage-unit">kWh</div>
                </div>
            </div>

            <hr class="separator-dark-grey">
            <hr class="separator-light-grey">

            <div class="calendar-left-compare-info compare-beginning">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
            <div class="calendar-left-compare-info compare-last-same-period">
                <div>
                    <span class="compare-percent"></span>
                    <span>%</span>
                </div>
                <div class="compare-subtext"></div>
            </div>
        </div>
        <div class="calendar-info-container">
            <div class="calendar-title"></div>
            <hr>
            <div class='calendar-weekday-header'>
                {% trans "<div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>" %}
            </div>
            <div class="calendar-day-container"></div>
            <div></div>
            <div class="calendar-legend-container">
                <div class="legend-color-block legend-color-block-better"></div>
                <div class="legend-label">{% trans "Better than<br>average overnight" %}</div>
                <div class="legend-color-block legend-color-block-worse"></div>
                <div class="legend-label">{% trans "Worse than<br>average overnight" %}</div>
                <div class="legend-color-block legend-color-block-average"></div>
                <div class="legend-label">{% trans "Average overnight" %}</div>
            </div>
        </div>
        <div class="calendar-vertical-info">
            <div class="calendar-title"></div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Lowest Overnight Energy Use:" %}</div>
            <div>
                <div class="usage-info-lowest-val-container">
                    <span class="lowest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="lowest-usage-date"></div>
            </div>
            <hr>
            <div class="calendar-info-subtitle">{% trans "Highest Overnight Energy Use:" %}</div>
            <div>
                <div class="usage-info-highest-val-container">
                    <span class="highest-usage-val"></span><span class="usage-info-unit"> kWh</span>
                </div>
                <div class="highest-usage-date"></div>
            </div>
            <hr>
            <div>
                <div class="energy-split-by-text">{% trans "Energy Split by:" %}</div>
                <div class="energy-split-pie"></div>
                <div class="energy-split-by-info">
                    <div>
                        <span class="first-split-text">{% trans "Weekdays: " %}</span><span class="first-split-val"></span>
                    </div>
                    <div>
                        <span class="second-split-text">{% trans "Weekends: " %}</span><span class="second-split-val"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="bottom-info-separator">
    <div class="calendar-bottom-info">
        <div>
            <div>{% trans "Lowest Overnight Energy Use:" %}</div>
            <div class="usage-info-lowest-val-container">
                <span class="lowest-usage-val"></span><span> kWh</span>
            </div>
            <div class="lowest-usage-date"></div>
        </div>
        <div>
            <div>{% trans "Highest Overnight Energy Use:" %}</div>
            <div class="usage-info-highest-val-container">
                <span class="highest-usage-val"></span><span> kWh</span>
            </div>
            <div class="highest-usage-date"></div>
        </div>
        <div>
            <div class="energy-split-pie"></div>
            <div class="energy-split-info">
                <div>{% trans "Energy Split by:" %}</div>
                <div>
                    <span>{% trans "Daytime: " %}</span><span class="first-split-val"></span>
                </div>
                <div>
                    <span>{% trans "Overnight: " %}</span><span class="second-split-val"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="not-available-footnote">{% trans "* Data not available or incomplete for this period" %}</div>
    <div class="calendar-footnote">{% trans "** The first month you started using En-trak" %}</div>
    <div class="overnight-footnote"></div>
    {% block hide_detail_bar_5 %}
    <div class="report-component-footer"></div>
    {% endblock %}

    <div class="detail-container"></div>
    <div style="clear:both;"></div>
</div>

{% block report_footnote %}
<div class="not-accurate-note">{% trans "Cost values are for general reference only and should not be treated as accurate for accounting purposes." %}</div>
{% endblock %}

<!-- use table because the CSS code done not well -->
<section id="download-reports">
<table class="centered-table" align="center">
<tbody>
<tr>
  <td>
  <div class="bottom-save-report-btn">
    <img alt="detailed report" src="{% static 'images/report/download_detail_report.png' %}">
    <span>{% trans "Download" %}</span></div>
  <div id="save-report-spinner" style="display:none;">
    <div class="load-container load-spinner"><div class="loader">Loading...</div></div>
    <span>Downloading</span>
  </div>
  </td>
</tr>
</tbody>
</table>
</section>

<div class="bottom-space"></div>

<form class="download-pdf-form" action="{% url 'report_pdf' system_code=company_system.code %}" method="POST">{% csrf_token %}
        <input name="start_timestamp" value="">
        <input name="end_timestamp" value="">
        <input name="report_type" value="">
        <input name="report_layout" value="">
</form>

<form class="download-raw-data-form" action="{% url 'export_data' system_code=company_system.code %}" method="POST">{% csrf_token %}
        <input name="start_timestamp" value="">
        <input name="end_timestamp" value="">
        <input name="unit" value="">
</form>

</div></div>
<!-- end ng-app -->
<script>
    angular.module("Entrak", [ "kendo.directives" ])
        .controller("ReportController", function($scope){})

setCalendar = function(currentDt, currentEndDt, eleSel, readings, averageUsage, isNotConcernFunc) {
    // var reportGenThis = this;
    var calendarInfoContainer = $(eleSel);
    // calendarInfoContainer.find(".calendar-title").text(this.genDtText(this.currentDt));

    var calendarContainer = calendarInfoContainer.find(".calendar-day-container");
    calendarContainer.empty();

    var calendarStartDt = moment(currentDt).startOf('w');
    var calendarEndDt = moment(currentEndDt).subtract(1, 's').endOf('w');
    for (var calendarNowDt=calendarStartDt; calendarNowDt.isBefore(calendarEndDt); calendarNowDt.add(1, 'd')) {
        var calendarDayEle = $("<div class='calendar-day'></div>");
        calendarDayEle.append("<div class='calendar-day-digit'>"+calendarNowDt.date()+"</div>");

        if (calendarNowDt.isBefore(currentDt)
            || calendarNowDt.isSame(currentEndDt)
            || calendarNowDt.isAfter(currentEndDt)) {
            calendarDayEle.addClass('calendar-day-out-range');
        } else if (isNotConcernFunc(calendarNowDt)) {
            calendarDayEle.addClass('calendar-day-not-concern');
        } else {
            var diffPercent;
            if (calendarNowDt.unix() in readings) {
                diffPercent = (readings[calendarNowDt.unix()]-averageUsage)/averageUsage*100;
            } else {
                diffPercent = 0;
            }
            diffPercent = parseFloat(Utils.fixedDecBaseOnVal(diffPercent));

            var diffPercentText;
            if (diffPercent >= 0) {
                diffPercentText = "<span class='calendar-day-plus-symbol'>+</span> "+diffPercent;
            } else {
                diffPercentText = "<span class='calendar-day-minus-symbol'>-</span> "+Math.abs(diffPercent);
            }
            if (diffPercent >= 5) {
                calendarDayEle.addClass('calendar-day-worse');
            } else if (diffPercent <= -5) {
                calendarDayEle.addClass('calendar-day-better');
            }
            calendarDayEle.append("<div class='calendar-day-percent'>"
                +diffPercentText
                +"<span class='calendar-day-percent-symbol'>%</span></div>");
        }

        calendarContainer.append(calendarDayEle);
    }
}


getReportData = function() {
    var report_data;
    var requestData = {
        report_type: 'month',
        start_timestamp: {{ report_start|date:"U" }},
        end_timestamp: {{ report_end|date:"U" }}
    };

    $.ajax({
        type: "POST",
        url: "/{{ company_system.code }}/report_data/",
        data: requestData,
        async: false
    })
    .done(function(data) {
        report_data = data;
    });

    return report_data
}

$(document).ready(function()  {

    // using jQuery
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });


    var report_data = getReportData();

    var report_readings = {};
    $.each(report_data.groupedSourceInfos, function(groupIdx, info) {
        $.each(info.currentReadings, function(timestamp, readingVal) {
            report_readings[timestamp] = ((timestamp in report_readings) ? report_readings[timestamp] : 0) + readingVal;
        });
    });

    //average uage
    var average_usage = 0;
    $.each(report_data.groupedSourceInfos, function(groupIdx, info) {
        average_usage += info['currentWeekdayInfo'].average;
    });

    // for weekday report
    var isNotConcernFunc = function(targetDt) {
        return (targetDt.day() == 0
            || targetDt.day() == 6)
            // || ($.inArray(targetDt.format("YYYY-MM-DD"), reportGenThis.holidays) != -1))
    }

    var report_start = new Date("{{ report_start.isoformat }}");
    var report_end = new Date("{{ report_end.isoformat }}");

    setCalendar(
        report_start, report_end,
        '#weekday-info .calendar-info-container', report_readings, average_usage, isNotConcernFunc);

    $('#weekday-info .average-usage').html(average_usage);

    /*
    var overnight_readings = {};
    $.each(report_data.groupedSourceInfos, function(groupIdx, info) {
        $.each(info.overnightcurrentReadings, function(timestamp, readingVal) {
            overnight_readings[timestamp] =
                ((timestamp in combinedOvernightCurrentReadings) ? overnight_readings[timestamp] : 0) + readingVal;
        });
    });
    */


    $('#monthly-report-content div').each(function() {
        var a = $(this).find('.menu-target:first');
        var m = $(this).find('.menu-content:first').kendoContextMenu({
            orientation: 'horizontal',
            target: a,
            showOn: 'click'
        });
    });
});
</script>
{% endblock %}
