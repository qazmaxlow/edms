{% extends "page_base.html" %}

{% load i18n %}
{% load entrak_extras %}
{% load static %}
{% load humanize %}

{% block ga_page_title %}report{% endblock %}

{% block extra_head %}
{{block.super}}
{% get_current_language as LANGUAGE_CODE %}

<link rel="stylesheet" type="text/css" href="{% static 'css/drop-down-panel.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/report.css' %}">

<link rel="stylesheet" type="text/css" href="{% static 'css/report-zh-tw.css' %}">

<script src="{% static 'js/jquery-cookie-master/jquery.cookie.js' %}"></script>
<script src="{% static 'js/csrf_ajax.js' %}"></script>
<script src="{% static 'js/moment-with-locales.js' %}"></script>
<script src="{% static 'js/moment-timezone-with-data.min.js' %}"></script>
<script src="{% static 'js/mustache.js-master/mustache.js' %}"></script>
<script src="{% static 'js/jquery.tinysort.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.min.js' %}"></script>
<script src="{% static 'js/flot/jquery.flot.pie.min.js' %}"></script>
<script src="{% static 'js/entrak-system.js' %}"></script>
<script src="{% static 'js/entrak-utils.js' %}"></script>
<script src="{% static 'js/report-generator.js' %}"></script>

<link href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/kendoui/styles/kendo.common.min.css' %}" rel="stylesheet">
<!-- <link href="{% static 'assets/kendoui/styles/kendo.default.min.css' %}" rel="stylesheet"> -->
<!-- Because now using jquery v1.11 -->
<!-- <script src="{% static 'assets/kendoui/js/jquery.min.js' %}"></script> -->
<script src="{% static 'assets/kendoui/js/angular.min.js' %}"></script>
<script src="{% static 'assets/kendoui/js/kendo.all.min.js' %}"></script>

<!-- hack for combining bootstrap -->
<style>
  #menu-links li:hover, #menu-links li.menu-links-selected {
     height: auto;
  }

  .panel-header-left-menu h3 {
    margin: 0;
    height: 33px;
  }

</style>

<style>
  .report-summary .time-type {
    color: #44586a;
    font-weight: 600;
    font-size: 3 rem;
    padding: 25px 0;
    border-bottom: #e8ebeb solid 3px;
  }

  .report-summary .content {
    background-color: #eff2f2;
  }

  .report-summary .col-xs-3 {
    background-color: white;
    border-left: #e8ebeb solid 3px;
  }

  .report-summary img.icon {
    padding: 20px;
    height: 120px;
    width: 120px;
  }
</style>

<!-- <script type="text/javascript"> -->
<!-- // put here to share with extended template -->
<!-- var report = {}; -->
<!-- report.reportGeneratorMultiLangTexts = { -->
<!--     'reportTypeMonthDtFormat': '{% trans "MMM YYYY" %}', -->
<!--     'reportTypeYearDtFormat': '{% trans "YYYY" %}', -->
<!--     'reportTypeCustomMonthDtFormat': '{% trans "D MMM YYYY, ddd" %}', -->
<!--     'reportTypeWeekDtFormat': '{% trans "D MMM YYYY, ddd" %}', -->
<!--     'genDtTo': '{% trans " to " %}', -->
<!--     'tons': '{% trans " tons" %}', -->
<!--     'tonsCo2': '{% blocktrans %} tons<span class="basic-info-col-unit"> CO<sub>2</sub></span>{% endblocktrans %}', -->
<!--     'reportTypeNameMonth': '{% trans "report_type_name_month" %}', -->
<!--     'reportTypeNameYear': '{% trans "report_type_name_year" %}', -->
<!--     'reportTypeNameQuarter': '{% trans "report_type_name_quarter" %}', -->
<!--     'reportTypeNameWeek': '{% trans "report_type_name_week" %}', -->
<!--     'more': '{% trans "more" %}', -->
<!--     'less': '{% trans "less" %}', -->
<!--     'overall': '{% trans "Overall: " %}', -->
<!--     'calendarMore': '{% trans "calendar_more" %}', -->
<!--     'calendarLess': '{% trans "calendar_less" %}', -->
<!--     'comparedTo': '{% trans "compared<br>to " %}', -->
<!--     'mSquare': '{% trans " m²" %}', -->
<!--     'pandas': '{% trans " pandas" %}', -->
<!--     'beginDtFormat': '{% trans "MMMM YYYY" %}', -->
<!--     'lastMonth': '{% trans "last month" %}', -->
<!--     'last_week': '{% trans "last week" %}', -->
<!--     'samePeriodLastYear': '{% trans "same period last year" %}', -->
<!--     'calendarUsageDtFormat': '{% trans "D MMM YYYY" %}', -->
<!--     'calendarTypeWeekday': '{% trans "Weekday" %}', -->
<!--     'calendarTypeWeekend': '{% trans "Weekend" %}', -->
<!--     'calendarTypeOvernight': '{% trans "Overnight" %}', -->
<!--     'calendarSplitWeekdays': '{% trans "Weekdays" %}', -->
<!--     'calendarSplitWeekends': '{% trans "Weekends" %}', -->
<!--     'calendarSplitDaytime': '{% trans "Daytime" %}', -->
<!--     'calendarSplitOvernight': '{% trans "Overnight" %}', -->
<!--     'overnightFootnoteFormat': '{% trans "hh:mmA" %}', -->
<!--     'comparePastLabelFormat': '{% trans "MMM D" %}', -->
<!-- }; -->

<!-- </script> -->
{% endblock %}

{% block selected-menu-link-id %}menu-link-report{% endblock %}
{% block system_menu_target_view %}report{% endblock %}
{% block breadcrumb_target_view %}report{% endblock %}

{% block page_title %}{% trans "THE REPORTS PAGE" %}{% endblock %}
{% block page_subtitle %}{% trans "Get all your information here at the" %}{% endblock %}

{% block extra_script %}
{{block.super}}
{% get_current_language as LANGUAGE_CODE %}

<script>

</script>
{% endblock %}

{% block page_content %}

    <div ng-app="Entrak">
    <div ng-controller="ReportController" class="container">
        <div kendo-window="win_report"
             k-width="1600" k-height="800" k-visible="false" k-iframe="true"
             >
        </div>

<div class="panel-component">
    <div class="drop-down-panel-header">
        <div class="panel-header-left-menu">
            <h3 panel="monthly-report">
                {% trans "Monthly Report" %}</h3><h3 panel="customize-report">
                {% trans "Customize Report" %}</h3><h3 panel="download-data">{% trans "Download Data" %}</h3>
        </div>
    </div>

    <div id="xpanel-content">
        <div id="monthly-report">

            <div id="monthly-report-content">
                {% for summary in monthly_summary %}
                <div>
                    <span ng-click="viewReport({{summary.dt|date:"Y"}}, '{{summary.dt|date:"b"}}')" class="summary-date-col" dt_timestamp="{{summary.timestamp}}">{% ifequal LANGUAGE_CODE 'zh-tw' %}{{summary.dt|date:"Y年M"}}{% else %}{{summary.dt|date:"M Y"}}{% endifequal %}</span>
                    {% language 'en' %}
                    <span>{{summary.energy_usage|floatformat:"0"|intcomma}}</span>
                    <span>{{summary.co2_usage|floatformat:"0"|intcomma}}</span>
                    <span>{{summary.money_usage|floatformat:"0"|intcomma}}
                              <div class="demo-section k-content">

            <button class="k-button" ng-show="!win2visible" ng-click="win2.open()">Open AJAX content</button>
        </div>
                    </span>
                    {% endlanguage %}
                    <a href="{% url 'entrak.download_report' systems.0.code summary.timestamp 0 'month' %}">
                      <img class="pdf-icon" src="{% static 'images/report/pdf-icon.png' %}">
                      <span class="pdf-text">PDF</span>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>



        <div id="download-raw-data">
            <div class="dl-data-title">{% trans "Here you can download your energy use data to files in .csv format." %}</div>
            <div class="dl-data-title">{% trans "Simply select the start date, end date and the units that you would like to obtain from the system." %}</div>
            <div class="customize-section-title"><span>1</span>{% trans "Choose your date" %}</div>
            <hr>
            <div class="dl-choose-date-section">
                <div class="report-datepicker-container">
                    <div>{% trans "Choose your start date" %}</div>
                    <div id="dl-data-start-datepicker" class="report-datepicker"></div>
                </div>
                <div class="report-datepicker-container">
                    <div>{% trans "Choose your end date" %}</div>
                    <div id="dl-data-end-datepicker" class="report-datepicker"></div>
                </div>
            </div>
            <div class="two-column-section">
                <div class="choose-unit-section">
                    <div class="customize-section-title"><span>2</span>{% trans "Select your units" %}</div>
                    <hr>
                    <div class="unit-container">
                        <span></span><span></span><span></span>
                    </div>
                </div>
                <div>
                    <div class="customize-section-title"><span>3</span>{% trans "Download your file" %}</div>
                    <hr>
                    <div class="create-report-section">
                        <div class="datetime-result">
                            <div class="datetime-result-title">{% trans "Energy data - kWh" %}</div>
                            <div class="datetime-result-from-to">
                                <div><span>{% trans "From:" %}</span><span class="from-date"></span></div>
                                <div><span>{% trans "To:" %}</span><span class="to-date"></span></div>
                            </div>
                            <hr>
                            <div class="create-report-btn">{% trans "Download File" %}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="report-summary text-center">
  <div class="row">
    <div class="col-xs-3">
      <div class="row time-type"><div class="col-xs-12">
          Monthly
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="power" class="icon" src="{% static 'images/report/lightning-energy.png' %}">
          <h3>${{ monthly_money_sum|floatformat:3 }}</h3>
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="decrease enegry" class="icon" src="{% static 'images/reports/decrease_engry.svg'  %}">
          <h3>{{ compare_last_month_money|floatformat:0 }}%</h3>
      </div></div>
    </div>
    <div class="col-xs-3">
      <div class="row time-type"><div class="col-xs-12">
          Weekdays
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="power" class="icon" src="{% static 'images/report/lightning-energy.png' %}">
          <h3>${{ month_summary.money_usage|floatformat:3 }}</h3>
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="decrease enegry" class="icon" src="{% static 'images/reports/decrease_engry.svg'  %}">
          <h3>{{ compare_last_month_money|floatformat:0 }}%</h3>
      </div></div>
    </div>
    <div class="col-xs-3">
      <div class="row time-type"><div class="col-xs-12">
          Overnight
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="power" class="icon" src="{% static 'images/report/lightning-energy.png' %}">
          <h3>${{ month_summary.money_usage|floatformat:3 }}</h3>
      </div></div>
      <div class="row content"><div class="col-xs-12">
          <img alt="decrease enegry" class="icon" src="{% static 'images/reports/decrease_engry.svg'  %}">
          <h3>{{ compare_last_month_money|floatformat:0 }}%</h3>
      </div></div>
    </div>
    <div class="col-xs-3">
      test
    </div>
  </div>
</div>


</div></div>
<!-- end ng-app -->
<script>
    angular.module("Entrak", [ "kendo.directives" ])
        .controller("ReportController", function($scope){
            $scope.viewReport = function(year, month) {
                $scope.win_report.refresh({ url: '../report/popup-report/' + year + '/' + month + '/'});
                $scope.win_report.open();
            }
        })
</script>
{% endblock %}
