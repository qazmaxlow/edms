{% extends "page_base.html" %}

{% load i18n %}
{% load entrak_extras %}
{% load static %}
{% load humanize %}

{% block ga_page_title %}report{% endblock %}

{% block extra_head %}
{{block.super}}
{% get_current_language as LANGUAGE_CODE %}

<link rel="stylesheet" type="text/css" href="{% static 'css/drop-down-panel.css' %}">

<script src="{% static 'js/jquery-cookie-master/jquery.cookie.js' %}"></script>
<script src="{% static 'js/csrf_ajax.js' %}"></script>
<script src="{% static 'js/moment-with-locales.js' %}"></script>
<script src="{% static 'js/moment-timezone-with-data.min.js' %}"></script>
<script src="{% static 'js/entrak-system.js' %}"></script>
<script src="{% static 'js/entrak-utils.js' %}"></script>
<script src="{% static 'js/report-generator.js' %}"></script>

<link href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/kendoui/styles/kendo.common.min.css' %}" rel="stylesheet">
<link href="{% static 'css/kendo.entrak.theme.css' %}" rel="stylesheet">

<!-- Because now using jquery v1.11 -->
<!-- <script src="{% static 'assets/kendoui/js/angular.min.js' %}"></script> -->
<!-- <script src="{% static 'assets/kendoui/js/kendo.all.min.js' %}"></script> -->
<script src="{% static 'assets/etkendoui/js/et.datepicker.js' %}"></script>
<script src="{% static 'assets/etkendoui/js/cultures/kendo.culture.zh-TW.js' %}"></script>

<link rel="stylesheet" type="text/css" href="{% static 'css/dashboard/widgets.css' %}">


{% endblock %}

{% block selected-menu-link-id %}menu-link-report{% endblock %}
{% block system_menu_target_view %}report{% endblock %}
{% block breadcrumb_target_view %}report{% endblock %}

{% block page_title %}{% trans "THE REPORTS PAGE" %}{% endblock %}
{% block page_subtitle %}{% trans "Get all your information here at the" %}{% endblock %}

{% block page_content %}

<div class="container" ng-app="Entrak">
    <div class="row">
        <div class="col-md-8">
            {% include "companies/dashboard/widgets/_real_time.html" with widget_id=4 %}
        </div>
        <div class="col-md-4">
            {% include "companies/dashboard/widgets/_tips.html" with widget_id=3 %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
          {% include "companies/dashboard/widgets/_tips.html" with widget_id=1 %}
        </div>
        <div class="col-md-4">
          {% include "companies/dashboard/widgets/_so_far.html" with widget_id=2 %}
        </div>
        <div class="col-md-4">
          {% include "companies/dashboard/widgets/_last_week_stats.html" with widget_id=5 %}
        </div>
    </div>
</div>

<script>
    var ngapp = angular.module("Entrak", [ "kendo.directives" ]);
    ngapp.controller("WidgetRealtime", function($scope) {
        var today_measures = [];

        var today_measure_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    async: false,
                    url: "{% url 'companies.measures.daily' current_system.code %}",
                    type: 'GET',
                    dataType: "json"
                }
            },
            schema: {
                model: {
                    fields: {
                        datetime: { type: "date"}
                    }
                }
            }
        });

        $scope.realTimeOptions = {
            series: [{
                type: "column",
                name: "Today",
                color: "#ffba00",
                data: today_measures
            }, {
                type: "line",
                name: "Last Wed",
                color: "#565656",
                data: [5,4,3,5]
            }],
            categoryAxis: {
                categories: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]

            }
        }

        $scope.updateTodayMeasure = function (e) {
            today_measure_ds.fetch().then(function() {
                var data = today_measure_ds.data();
                $.each(data, function(index, m) {
                    today_measures.push(m.value);
                });

                $scope.realTimeChart.refresh();
            });
        }

    });

    ngapp.controller("WidgetTips", function($scope){
        var tipsList = [{
            shortDesc: "Put a ribbon on it",
            longDesc: "Tie a ribbon to the vent of each aircon unit so you can easily tell if aircon has actually been turned off.",
            imgPath: ""
        },
        {
            shortDesc: "Put a ribbon on it2",
            longDesc: "Tie a ribbon to the vent of each aircon unit so you can easily tell if aircon has actually been turned off.",
            imgPath: ""
        }];

        $scope.curTips = 0;
        $scope.shortDesc = tipsList[$scope.curTips].shortDesc;
        $scope.longDesc = tipsList[$scope.curTips].longDesc;
        $scope.imgPath = tipsList[$scope.curTips].imgPath;

        $scope.showNext = function(goNext){
            $scope.curTips += goNext;
            if ($scope.curTips >= tipsList.length){
                $scope.curTips = 0;
            } else if ($scope.curTips < 0){
                $scope.curTips = tipsList.length - 1;
            }

            $scope.shortDesc = tipsList[$scope.curTips].shortDesc;
            $scope.longDesc = tipsList[$scope.curTips].longDesc;
            $scope.imgPath = tipsList[$scope.curTips].imgPath;
        }
    });


    ngapp.controller("WidgetSoFar", function($scope){

        var movies = [
            { "value": 2200, "name": "So far this week" },
            { "value": 1941, "name": "By this time last week" },
        ];

        $scope.soFarOptions = {
            chartArea: {
                height: 230,
                margin: 15,
                background: '#FCFCFC'
            },
            legend: {
                position: 'bottom'
            },
            seriesDefaults: {
                type: 'column'
            },
            series: [{
                markers: { visible: true },
                field: 'value',
                color: '#354960',
                gap: 0.5,
                labels: {
                    visible: true
                }
            }],
            dataSource: movies
        }
    });
</script>

{% endblock %}
